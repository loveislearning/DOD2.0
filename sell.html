<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>List Car - Drive On Demand</title>
Â  <link rel="stylesheet" href="style.css" />
</head>
<body>
Â  <header>
Â  Â  <nav class="navbar">
Â  Â  Â  <div class="logo">Drive On Demand</div>
Â  Â  Â  <ul class="nav-links">
Â  Â  Â  Â  <li><a href="index.html">Home</a></li>
Â  Â  Â  Â  <li><a href="buy.html">Luxury Cars</a></li>
Â  Â  Â  Â  <li><a href="budget.html">Budget Cars</a></li>
Â  Â  Â  Â  <li><a href="sell.html" class="active">Sell</a></li>
Â  Â  Â  Â  <li><a href="rent.html">Rent</a></li>
Â  Â  Â  Â  <li><a href="about.html">About</a></li>
Â  Â  Â  Â  <li><a href="contact.html">Contact Us</a></li>
Â  Â  Â  Â  <li><a href="login.html">Login</a></li>
Â  Â  Â  </ul>
Â  Â  </nav>
Â  </header>

Â  <section class="page-header">
Â  Â  <h1>List Your Car</h1>
Â  Â  <p>List your car for sale or rent</p>
Â  </section>

Â  <section class="form-section">
Â  Â  <form id="sellForm">
Â  Â  Â  <input type="text" id="name" placeholder="Your Name" required />
Â  Â  Â  <input type="email" id="email" placeholder="Your Email" required />
Â  Â  Â  <input type="text" id="model" placeholder="Car Model (e.g., Lamborghini Huracan)" required />
Â  Â  Â  Â  Â  Â  <input type="text" id="image" placeholder="Image URL or Path (e.g., images/car1.jpeg)" required />
Â  Â  Â  <input type="text" id="price" placeholder="Car Price Expectation (e.g., 3.5 Crore)" required />
Â  Â  Â  <button type="submit">Submit Listing</button>
Â  Â  </form>
Â  </section>

Â  <script>
Â  Â  document.getElementById("sellForm").addEventListener("submit", async function (e) {
Â  Â  Â  e.preventDefault();

Â  Â  Â  // ğŸ”‘ CRUCIAL FIX: Check login state. The dashboard script expects
Â  Â  Â  // a user ID to be available to link the listing.
Â  Â  Â  const storedUser = localStorage.getItem("loggedInUser");
Â  Â  Â  const storedUserId = localStorage.getItem("loggedInUserId");
Â  Â  Â  
Â  Â  Â  // Prioritize the dedicated ID storage, but fall back to the object if needed.
Â  Â  Â  let userIdToUse;
Â  Â  Â  if (storedUserId) {
Â  Â  Â  Â  Â  userIdToUse = storedUserId;
Â  Â  Â  } else if (storedUser) {
Â  Â  Â  Â  Â  const loggedInUser = JSON.parse(storedUser);
Â  Â  Â  Â  Â  userIdToUse = loggedInUser.id;
Â  Â  Â  }

Â  Â  Â  if (!userIdToUse) {
Â  Â  Â  Â  alert("âš ï¸ You must be logged in to list a car! Redirecting to login.");
Â  Â  Â  Â  window.location.href = "login.html";
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  // âœ… Collect form data including the new image field
Â  Â  Â  const name = document.getElementById("name").value.trim();
Â  Â  Â  const email = document.getElementById("email").value.trim();
Â  Â  Â  const model = document.getElementById("model").value.trim();
Â  Â  Â  const image = document.getElementById("image").value.trim(); // NEW
Â  Â  Â  const price = document.getElementById("price").value.trim();

Â  Â  Â  if (!name || !email || !model || !image || !price) {
Â  Â  Â  Â  alert("â—Please fill all fields before submitting!");
Â  Â  Â  Â  return;
Â  Â  Â  }

Â  Â  Â  const carData = {
Â  Â  Â  Â  name,
Â  Â  Â  Â  email,
Â  Â  Â  Â  model,
Â  Â  Â  Â  image, // NEW
Â  Â  Â  Â  price,
Â  Â  Â  Â  userId: userIdToUse, // Use the dynamically retrieved user ID
Â  Â  Â  };

Â  Â  Â  try {
Â  Â  Â  Â  const res = await fetch("http://localhost:3000/api/cars", {
Â  Â  Â  Â  Â  method: "POST",
Â  Â  Â  Â  Â  headers: { "Content-Type": "application/json" },
Â  Â  Â  Â  Â  body: JSON.stringify(carData),
Â  Â  Â  Â  });

Â  Â  Â  Â  const data = await res.json();

Â  Â  Â  Â  if (res.ok && data.success) {
Â  Â  Â  Â  Â  alert("âœ… Car listed successfully!");
Â  Â  Â  Â  Â  // Storing the last added car is optional but fine
Â  Â  Â  Â  Â  localStorage.setItem("lastAddedCar", JSON.stringify(data.car)); 
Â  Â  Â  Â  Â  this.reset();

Â  Â  Â  Â  Â  // Redirect to the dashboard
Â  Â  Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  Â  Â  window.location.href = "dashboard.html";
Â  Â  Â  Â  Â  }, 500);
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  alert("âŒ Error adding car: " + (data.message || "Unknown error"));
Â  Â  Â  Â  }
Â  Â  Â  } catch (error) {
Â  Â  Â  Â  console.error("Error:", error);
Â  Â  Â  Â  alert("âŒ Server error. Please check your backend connection (http://localhost:3000).");
Â  Â  Â  }
Â  Â  });
Â  </script>
<script src="sell.js"></script>
</body>
</html>